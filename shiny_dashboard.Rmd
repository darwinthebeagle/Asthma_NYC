---
title: "Single Column (Fill)"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(flexdashboard)
library(tidyverse)
library(viridis)
library(plotly)
library(stringr)
```

```{r, include = F}

assign_borough <- function(vector) {
  if (vector < 200)
    boro_assignment = "Bronx"
  else if (vector < 300)
    boro_assignment = "Brooklyn"
  else if (vector < 400)
    boro_assignment = "Manhattan"
  else if (vector < 500)
    boro_assignment = "Queens"
  else 
    boro_assignment = "Staten Island"
  
  boro_assignment
}

assign_outcome <- function(vector) {
  if (str_detect(vector, "ED"))
    outcome_assignment = "ED visits"
  else if (str_detect(vector, "Hospitalizations"))
    outcome_assignment = "Hospitalizations"
  else
    outcome_assignment = "Deaths"
  
  outcome_assignment
}

asthma_df <- readr::read_csv('./Data/nyc_asthma_cleaned.csv') %>% 
  filter(stringr::str_detect(name, "O3-Attributable") == T) %>% 
  mutate(geo_entity_id = as.numeric(geo_entity_id)) %>% 
  mutate(outcome = purrr::map(name, assign_outcome))

# asthma_df %>%
#   group_by(year_description) %>%
#   summarize(counts = n())
# 
# asthma_df %>% 
#   group_by(name) %>% 
#   summarize(counts = n())
# 
# asthma_df %>% 
#   mutate(obs = str_c(name, measure, year_description, sep = " ")) %>% 
#   distinct(obs)
# 
# asthma_df %>% 
#   distinct(geo_type_name)
```



Column {.sidebar}
-----------------------------------------------------------------------

```{r}
boros = c('Bronx', 'Brooklyn', 'Manhattan', 'Queens', 'Staten Island', 
          '(Select all)')

# selectInput widget
selectInput("boro_choice", label = h3("Select borough"), 
            choices = boros, selected = "Manhattan")
```

```{r}
outcomes = c(asthma_df %>% distinct(outcome) %>% pull(), '(Select all)')

# radioButtons widget
radioButtons("outcome_choice", label = h3("Choose outcome"), 
             choices = outcomes, selected = "ED visits")
```


Column
----------------------------------------------------------------------

### Chart 1
    
```{r, echo=F}
renderPlotly({
  asthma_df %>%
    filter(geo_type_name == 'UHF42') %>%
    mutate(borough = map(geo_entity_id, assign_borough)) %>%
    filter(
      if (input$boro_choice == '(Select all)') 
        TRUE 
      else 
        borough %in% input$boro_choice) %>% 
    filter(
      if (input$outcome_choice == '(Select all)')
        TRUE
      else
        outcome %in% input$outcome_choice
    ) %>% 
    mutate(geo_entity_name = forcats::fct_reorder(geo_entity_name, data_valuemessage)) %>% 
    
    plot_ly(x = ~geo_entity_name, y = ~data_valuemessage, type = "bar",
          alpha = 0.5)
})
```
    
### Chart 2

```{r}

```
