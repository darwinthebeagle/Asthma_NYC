---
title: "Data_cleaning"
author: "Felix Tran"
date: "November 27, 2018"
output: html_document
---

This Rmarkdown file contains code for reading in and cleaning the raw dataset.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(patchwork)
```

Read in dataset. Looking at the variable for year, some observations had values
which do not make sense. We thus kept only the observations with values for
the variable **year_description** that make sense. Cleaned variable names.
```{r}
asthma_df <- readr::read_csv('./Data/Air_Quality.csv')

asthma_df %>% 
  group_by(year_description) %>% 
  summarize(counts = n())

asthma_df <- asthma_df %>% 
  filter(year_description %in% c('2005', '2005-2007', '2009-2011', '2013')) %>% 
  janitor::clean_names()
```

Looking at the different observations recorded in the dataset. There are 18
unique kinds of observations recorded for NYC overall, by boroughs, and by
neighborhoods for the corresponding years. 
```{r}
asthma_df %>% 
  mutate(obsv = stringr::str_c(name, measure, sep = " ")) %>% 
  group_by(obsv) %>% 
  summarize(counts = n())
```

Save this cleaned dataset in a csv file. 
```{r}
readr::write_csv(asthma_df, path = './Data/nyc_asthma_cleaned.csv')
```


```{r}
asthma_clean = asthma_df %>%
  mutate(geo_entity_id = as.factor(geo_entity_id),
         UHF = recode(geo_entity_id, "101" = "Bronx", "102" = "Bronx", "103" = "Bronx", "104" = "Bronx", "105" = "Bronx", "106" = "Bronx", "107" = "Bronx", "201" = "Brooklyn", "202" = "Brooklyn", "203" = "Brooklyn", "204" = "Brooklyn", "205" = "Brooklyn", "206" = "Brooklyn", "207" = "Brooklyn", "208" = "Brooklyn", "209" = "Brooklyn", "210" = "Brooklyn", "211" = "Brooklyn", "301" = "Manhattan", "302" = "Manhattan", "303" = "Manhattan", "304" = "Manhattan", "305" = "Manhattan", "306" = "Manhattan", "307" = "Manhattan", "308" = "Manhattan", "309" = "Manhattan", "310" = "Manhattan", "401" = "Queens", "402" = "Queens", "403" = "Queens", "404" = "Queens", "405" = "Queens", "406" = "Queens", "407" = "Queens", "408" = "Queens", "409" = "Queens", "410" = "Queens", "501" = "Staten Island", "502" = "Staten Island", "503" = "Staten Island", "504" = "Staten Island")) %>%
  filter(geo_type_name == "UHF42")

benz_dens = asthma_clean %>% 
  filter(name == "Air Toxics Concentrations- Average Benzene Concentrations") %>%
  group_by(UHF) %>%
  ggplot(aes(x = data_valuemessage, fill = UHF)) +
  geom_density(alpha = 0.5) +
  theme(legend.position = "none")

SO2_dens = asthma_clean %>% 
  filter(name == "Boiler Emissions- Total SO2 Emissions") %>%
  group_by(UHF) %>%
  ggplot(aes(x = data_valuemessage, fill = UHF)) +
  geom_density(alpha = 0.5) +
  theme(legend.position = "none")

Formaldehyde_dens = asthma_clean %>% 
  filter(name == "Air Toxics Concentrations- Average Formaldehyde Concentrations") %>%
  group_by(UHF) %>%
  ggplot(aes(x = data_valuemessage, fill = UHF)) +
  geom_density(alpha = 0.5) + 
  theme(legend.position = "none")

PM_dens = asthma_clean %>% 
  filter(name == "Boiler Emissions- Total PM2.5 Emissions") %>%
  group_by(UHF) %>%
  ggplot(aes(x = data_valuemessage, fill = UHF)) +
  geom_density(alpha = 0.5) +
  theme(legend.position = "none")

NO2_dens = asthma_clean %>% 
  filter(name == "Boiler Emissions- Total NOx Emissions") %>%
  group_by(UHF) %>%
  ggplot(aes(x = data_valuemessage, fill = UHF)) +
  geom_density(alpha = 0.5) +
  theme(legend.position = "bottom")

(SO2_dens + PM_dens + Formaldehyde_dens + benz_dens + NO2_dens)
```

